.//=====================================================================
.//
.// File:      $RCSfile: create_object_action.inc,v $
.// Version:   $Revision: 1.30 $
.// Modified:  $Date: 2013/01/10 22:54:05 $
.//
.// (c) Copyright 2005-2014 by Mentor Graphics Corp. All rights reserved.
.//
.//=====================================================================
.// Licensed under the Apache License, Version 2.0 (the "License"); you may not
.// use this file except in compliance with the License.  You may obtain a copy
.// of the License at
.//
.//      http://www.apache.org/licenses/LICENSE-2.0
.//
.// Unless required by applicable law or agreed to in writing, software
.// distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
.// WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.   See the
.// License for the specific language governing permissions and limitations under
.// the License.
.//=====================================================================
.//
.// The function declared below is responsible for creating the core.ui
.// actions for creating new client model instances. They are declared
.// here because multiple plugins use the same actions to carry out these
.// tasks on the metamodel. Takes a path parameter so that the comment
.// correctly displays the generated files location. Also takes a context
.// menu entry parameter which is used to identify the type and target
.// instance of the action.
.//
.function create_object_action
  .param string path
  .param inst_ref cme
  .//
  .invoke result = get_action_class_name(cme)
  .assign action_name = "${result.body}"
  .assign attr_result = action_name  
  .select one class related by cme->O_OBJ[R2000]
  .invoke cn = get_class_name(class)
  .assign has_wizard = false
  .invoke fn = get_func_name(cme)
  .select any function from instances of S_SYNC where (selected.Name == "${fn.body}")
  .if (not_empty function)
    .select one wfl related by function->W_WOF[R2001]
    .if (not_empty wfl)
      .select any field related by wfl->W_STEP[R2005]->W_FLD[R2009]
      .if ( not_empty field )
        .assign has_wizard = true
      .end if
    .end if
  .end if
package org.xtuml.bp.core.ui;
//======================================================================
//
// File: ${path}/${action_name}.java
//
// WARNING:      Do not edit this generated file
// Generated by: ${info.arch_file_name}
// Version:      $$Revision: 1.30 $$
//
// (c) Copyright 2005-2014 by Mentor Graphics Corp.  All rights reserved.
//
//======================================================================
//
// This class is the main BridgePoint entry point for the action that
// creates new ${cme.Label}s.
//
import java.util.Iterator;

import org.eclipse.jface.action.IAction;
import org.eclipse.jface.preference.IPreferenceStore;
import org.eclipse.jface.viewers.ISelection;
import org.eclipse.jface.viewers.IStructuredSelection;
import org.eclipse.jface.viewers.StructuredSelection;
import org.eclipse.ui.IObjectActionDelegate;
import org.eclipse.ui.IWorkbenchPart;
  .if ( has_wizard )
import org.eclipse.jface.resource.ImageDescriptor;
import org.eclipse.jface.window.Window;
import org.eclipse.jface.wizard.WizardDialog;
  .end if
import org.xtuml.bp.core.*;
import org.xtuml.bp.core.common.*;
import org.xtuml.bp.core.util.OoaofgraphicsUtil;
import org.xtuml.bp.core.util.RenameActionUtil;
import org.xtuml.bp.core.util.TransactionUtil;
import org.xtuml.bp.core.util.UIUtil;
.if (cme.Specialism == "New")
import org.eclipse.jface.dialogs.MessageDialogWithToggle;
import org.eclipse.jface.preference.IPreferenceStore;
.end if 

public class ${action_name} implements IObjectActionDelegate {
  .if ( has_wizard )
  private IWorkbenchPart m_part;
  .end if

  /**
   * Constructor for ${action_name}.
   */
  public ${action_name}() {
    super();
  }
  /**
   * @see IObjectActionDelegate#setActivePart(IAction, IWorkbenchPart)
   */
  public void setActivePart(IAction action, IWorkbenchPart targetPart) {
    // The part is mainly needed to locate the selection provider, and
    // we cache our selection in core so no action is needed here.
  .if ( has_wizard )
    m_part = targetPart;
  .end if
  }
  /**
   * @see IActionDelegate#run(IAction)
   */
  public void run(IAction action) {
    IStructuredSelection structuredSelection = Selection.getInstance().getStructuredSelection();
  .// invoke the nominated function generated from the client model
  .if ( has_wizard )
    WizardDialog wd = ${fn.body}(structuredSelection);
    wd.open();
  .else    
    ${fn.body}(structuredSelection);
  .end if

    }
  /**
   * @see IActionDelegate#selectionChanged(IAction, ISelection)
   */
  public void selectionChanged(IAction action, ISelection selection) {
    .if(cme.Resultant_Class != "")
      .select any obj from instances of O_OBJ where (selected.Key_Lett == cme.Resultant_Class)
      .invoke class_name = get_class_name(obj);
      .if(class_name.body == "InterfaceOperation_c")
        action.setImageDescriptor(CorePlugin.getImageDescriptorFor("NewOperation", false)); 
      .elif(class_name.body == "InterfaceSignal_c")
        action.setImageDescriptor(CorePlugin.getImageDescriptorFor("NewSignal", false)); 
      .else       
        action.setImageDescriptor(CorePlugin.getImageDescriptorFor("${class_name.body}", false));
      .end if 
    .end if
  }
  .if ( has_wizard )
  // public for unit test
  public WizardDialog \
  .else
  private void \
  .end if
${fn.body}(IStructuredSelection selection) {
      .select any function from instances of S_SYNC where (selected.Name == "${fn.body}")
      .if (not_empty function)
        .invoke result = function_body(function)
${result.body}
      .else
        .print "ERROR: No function found for context menu entry: $Cr{cme.Label}"
      .end if
  }
} // end ${action_name}
.end function
.//
.//
.//
