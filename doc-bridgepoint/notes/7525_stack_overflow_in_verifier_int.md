---

This work is licensed under the Creative Commons CC0 License

---

# Stack Overflow Error in Verifier on a Reflexive with Multiple Identifiers.
### xtUML Project Implementation Note

1. Abstract
-----------
This document describes the fix for a reported bug.  A recursive call in
```Attribute Value.getRuntimeValue``` can fall into an endless loop causing a
Stack Overflow Error in Verifier.

2. Document References
----------------------
<a id="2.1"></a>2.1 [BridgePoint DEI #7525](https://support.onefact.net/issues/7525)
Stack Overflow Error in Verifier with breakpoints in code manipulating combined
reflexive and non-reflexive associations.

3. Background
-------------
As described in the bug report [[2.1]](#2.1), the Node class of the model has
a reflexive relation and multiple referential attributes including a compound
identifier.  The combination of the reflexive with multiple referential 
attributes is the root of the error.

The error, ```Unhandled event loop exception java.lang.StackOverflowError```,
occurs in Verifier.  It is generated by expanding the Node class of the model
in either the Session Explorer or Variables Pane of Verifier.  The error log
and trace indicate an endless loop caused by a recursive call in
```Attribute Value.getRuntimeValue```.

Note: creating the initial model as outlined in the bug report [[2.1]](#2.1)
did not reproduce the problem.  However, when that model was exported and then
imported into a new project the error was consistently reproduced.
During debugging it was discovered that the difference between these models was
the order that the referential attributes were iterated.  In the failed case,
the compound ID of Node was first.

The attribute values returned by getRuntimeValue are based on Attr_ID.  As
getRuntimeValue iterates over the Attr_IDs a check needs to be added to make
sure that the recursive call is not made again on the current Attr_ID.  This is
what causes the endless loop.

4. Requirements
---------------
4.1 Add a check to the recursive calls in ```Attribute Value.getRuntimeValue```
to keep from falling into an endless loop.

5. Work Required
----------------
5.1 In ```bp.core > ooaofooa > Instance > Attribute Value > getRuntimeValue```,
add an IF statement to check the current Attr_ID value to self.  If they are
the same, skip the recursive call: 
```
   if (self.Attr_ID == attr_val.Attr_ID)
     // If we just found ourself, skip over the recursive call to avoid
     // an infinite loop.
     continue;
   else
     return attr_val.getRuntimeValue();  //recursive call
   end if;
```

6. Implementation Comments
--------------------------
None.

7. Unit Test
------------
This is a manual test.

Setup:  Import ```7525_test_model``` from the xtuml/models repository
```test/``` folder.

7.1 Session Explorer Test  
* Launch Verifier
* Go to the Session Explorer window.
* Right-click and Execute ```Setup``` under ```FunctionsPackage```.
* Expand ```Node``` under ```ClassesPackage```.
* __R__ Success (The two nodes are displayed and the "Unhandled event loop
  exception java.lang.StackOverflow Error" pop-up does not occur.)

8. User Documentation
---------------------
None. 

9. Code Changes
---------------
Fork/Repository: jason-rhodes/bridgepoint  
Branch: 7525_stack_overflow_in_verifier

<pre>
org.xtuml.bp.core/models/org.xtuml.bp.core/ooaofooa/Instance/Attribute Value/Attribute Value.xtuml
</pre>

Fork/Repository: jason-rhodes/models  
Branch: 7525_stack_overflow_in_verifier

<pre>
New project: test/7525_test_model
</pre>

End
---

